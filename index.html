<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lovely Music Idiots Awards 2025</title>
    
    <!-- エラー捕捉用のスタイル -->
    <style>
        #error-overlay { display: none; position: fixed; inset: 0; background: #222; color: #ff5555; padding: 20px; z-index: 9999; overflow: auto; font-family: monospace; white-space: pre-wrap; }
        body { background-color: black; color: white; margin: 0; }
        @keyframes spin-slow { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 20s linear infinite; }
    </style>

    <!-- エラー捕捉スクリプト -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            var overlay = document.getElementById('error-overlay');
            if(overlay) {
                overlay.style.display = 'block';
                overlay.innerText = "【エラーが発生しました】\n" + msg + "\n\n" + (error && error.stack ? error.stack : "");
            }
        };
    </script>

    <!-- React & ReactDOM (v18.2.0 固定) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel (v7.23.0 固定) -->
    <script src="https://unpkg.com/@babel/standalone@7.23.0/babel.min.js"></script>
    <!-- Tailwind CSS (v3.4.1 固定) -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="error-overlay"></div>
    <div id="root"></div>

    <script type="text/babel" data-presets="env,react">
        // ==========================================
        // ★設定エリア★
        // ==========================================

        // 1. GASアプリのURL
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbyo0ywsxhTU5Bx4-rkSkc1JjrqJanQ8nRX785UvY-n5RVHCiYoE9X3jMuReDlcGGJlA/exec"; 

        // 2. 公開設定 (false: 隠す / true: 公開)
        const IS_REVEALED = true; 

        // ==========================================

        const { useState, useEffect, useMemo } = React;

        // --- アイコンコンポーネント定義 ---
        const Icons = {
          ChevronRight: ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>
          ),
          ChevronLeft: ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m15 18-6-6 6-6"/></svg>
          ),
          Disc: ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
          ),
          Play: ({ size = 24, className = "", fill="none" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>
          ),
          X: ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
          ),
          Loader2: ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
          ),
          Lock: ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          )
        };

        const { ChevronRight, ChevronLeft, Disc, Play, X, Loader2, Lock } = Icons;

        // --- ヘルパー関数 ---
        const getYouTubeId = (url) => {
             if (!url || typeof url !== 'string') return null;
             const match = url.match(/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);
             return (match && match[1].length === 11) ? match[1] : null;
        };

        // --- アプリロジック ---

        const MOCK_DATA = {
          eventTitle: "BEST MUSIC TOP3 2025",
          subTitle: "THE LOVELY MUSIC IDIOTS' AWARDS",
          introText: [
            "我々は、ただの音楽好きではない。",
            "我々は、音の探求者であり、時代の証人である。",
            "今宵、三人の『愛すべき音楽馬鹿達』が、",
            "自らの2025年を定義した音の軌跡をここに記す。"
          ],
          rules: [
            { title: "SELECTION", desc: "2025年に聴いた楽曲の中から、自身のベストソングトップ3を選出する。発表年は問わない。" },
            { title: "SUBMISSION", desc: "選出した楽曲は、事前に指定のGoogleフォームへ投稿する。" },
            { title: "EXPERIENCE", desc: "LINEのYouTube共有機能を用い、全員で楽曲を体験する。" }
          ],
          interludeQuote: {
            text: "WHERE WORDS FAIL, MUSIC SPEAKS.",
            author: "Hans Christian Andersen"
          },
          presenters: [] 
        };

        const YouTubeModal = ({ videoId, onClose }) => {
          if (!videoId) return null;
          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-in fade-in duration-300">
              <div className="relative w-full max-w-4xl aspect-video bg-black border border-white/20">
                <button onClick={onClose} className="absolute -top-12 right-0 text-white flex items-center gap-2 hover:text-red-500 transition-colors">
                  <span className="text-sm">CLOSE</span> <X size={32} />
                </button>
                <iframe width="100%" height="100%" src={`https://www.youtube.com/embed/${videoId}?autoplay=1`} frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
              </div>
            </div>
          );
        };

        const SlideContainer = ({ children, className = "" }) => (
          <div className={`min-h-screen w-full flex flex-col items-center justify-center p-6 transition-colors duration-700 ${className}`}>{children}</div>
        );

        const NoiseBackground = () => (
          <div className="fixed inset-0 pointer-events-none opacity-[0.03] z-0 mix-blend-overlay" style={{backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}} />
        );

        const FadeIn = ({ children, delay = 0 }) => {
          const [isVisible, setIsVisible] = useState(false);
          useEffect(() => { const timer = setTimeout(() => setIsVisible(true), delay); return () => clearTimeout(timer); }, [delay]);
          return <div className={`transition-all duration-1000 transform ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}>{children}</div>;
        };

        const Navigation = ({ onNext, onPrev, nextLabel = "NEXT", showPrev = true, colorClass = "text-white" }) => (
          <div className={`fixed bottom-8 right-8 z-50 ${colorClass} flex items-center gap-8`}>
            {showPrev && (
              <button onClick={onPrev} className="flex items-center gap-2 hover:opacity-50 transition-opacity group">
                <ChevronLeft size={20} className="group-hover:-translate-x-1 transition-transform" />
                <span className="text-sm tracking-widest">BACK</span> 
              </button>
            )}
            <button onClick={onNext} className="flex items-center gap-2 hover:opacity-50 transition-opacity group">
              <span className="text-sm tracking-widest">{nextLabel}</span> 
              <ChevronRight size={20} className="group-hover:translate-x-1 transition-transform" />
            </button>
          </div>
        );

        const RevealGuard = ({ children, placeholder = "COMING SOON" }) => {
           if (IS_REVEALED) return children;
           return (
               <div className="relative w-full h-full flex items-center justify-center bg-black/40 backdrop-blur-md rounded border border-white/10 p-4 min-h-[100px]">
                   <div className="flex flex-col items-center text-white/50 gap-2">
                       <Lock size={24} />
                       <span className="text-sm font-bold tracking-[0.2em]">{placeholder}</span>
                   </div>
               </div>
           );
        };

        function App() {
          const [currentSlide, setCurrentSlide] = useState(0);
          const [playingVideoId, setPlayingVideoId] = useState(null);
          const [appData, setAppData] = useState(null);
          const [loading, setLoading] = useState(true);
          const totalSlides = 12;

          useEffect(() => {
            if (!GAS_API_URL || GAS_API_URL.includes("xxxx")) {
                console.log("Using Mock Data (No URL)");
                setAppData(MOCK_DATA);
                setLoading(false);
                return;
            }

            fetch(GAS_API_URL)
              .then(res => {
                  if (!res.ok) throw new Error("Network response was not ok");
                  return res.json();
              })
              .then(data => { 
                  if(data && data.presenters && data.presenters.length > 0) {
                      setAppData(data); 
                  } else {
                      setAppData(MOCK_DATA);
                  }
                  setLoading(false); 
              })
              .catch(err => { 
                  console.error("Fetch failed:", err); 
                  setAppData(MOCK_DATA);
                  setLoading(false); 
              });
          }, []);

          const nextSlide = () => setCurrentSlide(prev => Math.min(prev + 1, totalSlides - 1));
          const prevSlide = () => setCurrentSlide(prev => Math.max(0, prev - 1));
          
          const handlePlay = (url) => {
             if (!IS_REVEALED) return;
             const id = getYouTubeId(url);
             if (id) setPlayingVideoId(id);
          };

          if (loading) return <div className="min-h-screen bg-black flex items-center justify-center text-white"><Loader2 className="animate-spin" size={48} /></div>;
          
          if (!appData) {
              return <div className="min-h-screen bg-black flex items-center justify-center text-white"><div>Data Load Failed.</div></div>;
          }

          // Slide Components
          const Opening = () => (
            <SlideContainer className="bg-black text-white text-center">
              <div className="z-10 flex flex-col items-center border-4 border-white p-12 relative">
                 <FadeIn delay={200}><div className="text-sm tracking-[0.3em] mb-4 text-gray-400">00. OPENING</div></FadeIn>
                 <FadeIn delay={600}><h1 className="text-4xl md:text-7xl font-black mb-6">BEST MUSIC<br/>TOP3 2025</h1></FadeIn>
                 <FadeIn delay={1200}><p className="text-lg tracking-widest text-gray-300">THE LOVELY MUSIC IDIOTS' AWARDS</p></FadeIn>
              </div>
              <Navigation onNext={nextSlide} onPrev={prevSlide} showPrev={false} nextLabel="START" />
            </SlideContainer>
          );
          
          const Manifesto = () => (
             <SlideContainer className="bg-white text-black items-start md:items-center">
                <div className="max-w-3xl space-y-8 z-10">
                   <FadeIn delay={100}><div className="text-sm font-bold tracking-widest mb-12 border-b border-black pb-2 inline-block">01. INTRODUCTION</div></FadeIn>
                   {appData.introText && appData.introText.map((t, i) => (
                       t === "2025" ? null : <FadeIn key={i} delay={300+i*200}><p className="text-2xl font-serif">{t}</p></FadeIn>
                   ))}
                </div>
                <Navigation onNext={nextSlide} onPrev={prevSlide} colorClass="text-black" />
             </SlideContainer>
          );

          const Rules = () => (
            <SlideContainer className="bg-neutral-100 text-black">
               <div className="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl z-10">
                 {appData.rules && appData.rules.map((r, i) => (
                    <FadeIn key={i} delay={i*300}>
                       <div className="bg-white p-8 h-full shadow-lg border-t-4 border-black">
                          <div className="text-4xl font-black text-gray-200 mb-4">0{i+1}</div>
                          <h3 className="text-xl font-bold mb-4">{r.title}</h3>
                          <p className="text-gray-600 font-serif">{r.desc}</p>
                       </div>
                    </FadeIn>
                 ))}
               </div>
               <Navigation onNext={nextSlide} onPrev={prevSlide} colorClass="text-black" />
            </SlideContainer>
          );

          const Reveal32 = ({ p }) => (
             <SlideContainer className={`text-white relative overflow-hidden ${p.themeColor}`}>
                <div className="z-10 w-full max-w-4xl relative">
                   <div className="flex justify-between items-end border-b border-white/30 pb-4 mb-12">
                      <div><FadeIn delay={100}><div className="text-xs tracking-[0.4em] mb-2">02. THE REVEAL</div><h2 className="text-6xl font-black uppercase">{p.nameEn}</h2></FadeIn></div>
                      <div className="text-right"><FadeIn delay={300}><div className="text-sm text-white/60">PRESENTER</div><div className="text-xl">{p.name}</div></FadeIn></div>
                   </div>
                   <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                      <FadeIn delay={600}>
                         <div onClick={() => handlePlay(p.ranks[3]?.youtubeUrl)} className={`bg-white/10 p-8 border border-white/20 transition-colors relative group ${IS_REVEALED ? 'cursor-pointer hover:bg-white/20' : ''}`}>
                            <div className="flex justify-between mb-6"><span className="text-5xl font-black text-white/20">03</span><span className="text-xs border border-white/40 px-2 py-1 h-fit rounded">BRONZE</span></div>
                            <RevealGuard>
                                <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity"><Play size={24} fill="white" /></div>
                                <h3 className="text-2xl font-bold mb-2">{p.ranks[3]?.song}</h3><p className="text-white/70">{p.ranks[3]?.artist}</p>
                                <div className="mt-6 pt-4 border-t border-white/10 text-sm italic">"{p.ranks[3]?.comment}"</div>
                            </RevealGuard>
                         </div>
                      </FadeIn>
                      <FadeIn delay={900}>
                         <div onClick={() => handlePlay(p.ranks[2]?.youtubeUrl)} className={`bg-white text-black p-8 shadow-2xl transform md:translate-y-8 transition-colors relative group ${IS_REVEALED ? 'cursor-pointer hover:bg-gray-100' : ''}`}>
                            <div className="flex justify-between mb-6"><span className="text-5xl font-black text-gray-200">02</span><span className="text-xs border border-black px-2 py-1 h-fit rounded">SILVER</span></div>
                            <RevealGuard>
                                <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity"><Play size={24} fill="black" /></div>
                                <h3 className="text-2xl font-bold mb-2">{p.ranks[2]?.song}</h3><p className="text-gray-600">{p.ranks[2]?.artist}</p>
                                <div className="mt-6 pt-4 border-t border-gray-200 text-sm italic">"{p.ranks[2]?.comment}"</div>
                            </RevealGuard>
                         </div>
                      </FadeIn>
                   </div>
                </div>
                <Navigation onNext={nextSlide} onPrev={prevSlide} colorClass="mix-blend-difference text-white" />
             </SlideContainer>
          );

          const Interlude = () => (
             <SlideContainer className="bg-zinc-900 text-white text-center">
                <FadeIn delay={500}><blockquote className="text-3xl md:text-5xl font-serif italic mb-8">“{appData.interludeQuote && appData.interludeQuote.text}”</blockquote></FadeIn>
                <FadeIn delay={1000}><cite className="text-sm tracking-widest text-gray-400">— {appData.interludeQuote && appData.interludeQuote.author}</cite></FadeIn>
                <Navigation onNext={nextSlide} onPrev={prevSlide} label="PROCEED" />
             </SlideContainer>
          );

          const FinalTitle = () => (
             <SlideContainer className="bg-black text-white text-center">
                <FadeIn delay={500}><h2 className="text-5xl md:text-8xl font-black mb-4">THE NO.1 PICKS</h2></FadeIn>
                <FadeIn delay={800}><p className="text-gray-400 tracking-widest">THE DEFINING SOUNDS OF 2025</p></FadeIn>
                <Navigation onNext={nextSlide} onPrev={prevSlide} label="START" />
             </SlideContainer>
          );

          // ★更新箇所★ コメントの色変更
          const FinalReveal = ({ p }) => {
             const videoId = getYouTubeId(p.ranks[1]?.youtubeUrl);
             const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : null;

             return (
                 <SlideContainer className="bg-black text-white text-center relative">
                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-20 animate-spin-slow pointer-events-none"><Disc size={600} strokeWidth={0.5} /></div>
                    
                    <div className="z-10 relative w-full max-w-2xl">
                       <FadeIn delay={200}>
                           <div className="mb-8"><span className="bg-white text-black px-4 py-1 text-xs font-bold uppercase tracking-widest">{p.nameEn}'S BEST SONG</span></div>
                       </FadeIn>
                       <FadeIn delay={600}>
                          <div 
                            onClick={() => handlePlay(p.ranks[1]?.youtubeUrl)} 
                            className={`border-4 border-white p-8 md:p-16 bg-gray-900 transition-transform mb-8 relative group overflow-hidden ${IS_REVEALED ? 'cursor-pointer hover:scale-105' : ''}`}
                          >
                             <RevealGuard placeholder="???">
                                 {thumbnailUrl && (
                                     <img src={thumbnailUrl} alt={p.ranks[1]?.song} className="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-40 transition-opacity duration-500" />
                                 )}
                                 <div className="relative z-10">
                                     <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-20 pointer-events-none"><Play size={64} fill="white" /></div>
                                     <h3 className="text-4xl md:text-6xl font-black mb-4 drop-shadow-lg">{p.ranks[1]?.song}</h3>
                                     <p className="text-xl md:text-2xl text-gray-100 drop-shadow-md">{p.ranks[1]?.artist}</p>
                                 </div>
                             </RevealGuard>
                          </div>
                       </FadeIn>
                       <FadeIn delay={1200}>
                           <RevealGuard placeholder="">
                               {/* 変更箇所: コメントを完全な白にしてドロップシャドウ追加 */}
                               <p className="text-white font-serif italic text-lg drop-shadow-md">"{p.ranks[1]?.comment}"</p>
                           </RevealGuard>
                       </FadeIn>
                    </div>
                    <Navigation onNext={nextSlide} onPrev={prevSlide} />
                 </SlideContainer>
             );
          };

          const Archive = () => (
             <SlideContainer className="bg-neutral-900 text-white">
                <div className="w-full max-w-6xl z-10">
                   <div className="flex justify-between items-end mb-12 border-b border-gray-700 pb-4"><h2 className="text-3xl font-bold">05. ARCHIVE</h2></div>
                   <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                      {appData.presenters && appData.presenters.map(p => Object.values(p.ranks).map((r, i) => {
                         const videoId = getYouTubeId(r.youtubeUrl);
                         const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : null;
                         return (
                             <div key={`${p.id}-${i}`} onClick={() => handlePlay(r.youtubeUrl)} className={`aspect-square bg-gray-800 relative group border border-gray-700 flex items-center justify-center overflow-hidden ${IS_REVEALED ? 'cursor-pointer' : ''}`}>
                                <RevealGuard placeholder="LOCKED">
                                    {thumbnailUrl && (
                                        <img src={thumbnailUrl} alt={r.song} className="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:opacity-30 transition-opacity duration-300" />
                                    )}
                                    <Play size={48} className="opacity-80 group-hover:opacity-100 text-white z-10 drop-shadow-md" fill="currentColor" />
                                    <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex flex-col items-center justify-center p-4 text-center transition-opacity z-20">
                                       <span className="text-xs text-gray-300 mb-1">SELECTED BY {p.nameEn}</span>
                                       <p className="font-bold text-lg mb-1">{r.song}</p>
                                       <p className="text-sm text-gray-300">{r.artist}</p>
                                    </div>
                                </RevealGuard>
                             </div>
                         );
                      }))}
                   </div>
                   <div className="mt-24 text-center flex justify-center gap-4">
                      <button onClick={prevSlide} className="border border-white/30 px-8 py-3 hover:bg-white hover:text-black transition-colors uppercase tracking-widest">BACK</button>
                      <button onClick={() => setCurrentSlide(0)} className="border border-white/30 px-8 py-3 hover:bg-white hover:text-black transition-colors uppercase tracking-widest">REPLAY</button>
                   </div>
                </div>
             </SlideContainer>
          );

          // メインレンダリング
          return (
             <>
               <NoiseBackground />
               <YouTubeModal videoId={playingVideoId} onClose={() => setPlayingVideoId(null)} />
               {currentSlide === 0 && <Opening />}
               {currentSlide === 1 && <Manifesto />}
               {currentSlide === 2 && <Rules />}
               {currentSlide === 3 && <Reveal32 p={appData.presenters[0]} />}
               {currentSlide === 4 && <Reveal32 p={appData.presenters[1]} />}
               {currentSlide === 5 && <Reveal32 p={appData.presenters[2]} />}
               {currentSlide === 6 && <Interlude />}
               {currentSlide === 7 && <FinalTitle />}
               {currentSlide === 8 && <FinalReveal p={appData.presenters[0]} />}
               {currentSlide === 9 && <FinalReveal p={appData.presenters[1]} />}
               {currentSlide === 10 && <FinalReveal p={appData.presenters[2]} />}
               {currentSlide === 11 && <Archive />}
             </>
          );
        }

        // 実行
        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        } catch (e) {
            console.error(e);
            document.body.innerHTML += '<div style="color:red;padding:20px;">CRITICAL ERROR: ' + e.message + '</div>';
        }
    </script>
</body>
</html>
